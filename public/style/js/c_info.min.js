function img_check(a, b, c, d) {
    var e = $("#" + d).val();
    this.AllowExt = ".jpg,.gif,.jpeg,.png,.pjpeg",
    this.FileExt = a.value.substr(a.value.lastIndexOf(".")).toLowerCase(),
    0 != this.AllowExt && -1 == this.AllowExt.indexOf(this.FileExt) ? $("#" + c + "_error").text("只支持jpg、gif、png、jpeg格式，请重新上传").show() : ($("#" + c + "_error").text("").hide(),
    $.ajaxFileUpload({
        url: b,
        secureuri: !1,
        fileElementId: c,
        data: {
            type: e
        },
        dataType: "text",
        success: function(a) {
            "" != a ? ($("#logoShow img").attr("src", ctx + "/" + a),
            $("#logoNo").hide(),
            $("#logoShow").show(),
            $("#logo").val(a)) : $("#" + c + "_error").text("上传失败，请重新上传").show()
        },
        error: function() {
            $("#" + c + "_error").text("上传失败，请重新上传").show()
        }
    }))
}
$(function() {
    var b, c, a = !1;
    
    $("#stepTip a").bind("click", function() {
        $(this).parent("#stepTip").remove()
    }),
    b = {
        expires: 1
    },

    $(document).click(function() {
        var a = [];
        $("#box_industry li.current").length > 2 ? alert("行业领域最多可选2个") : ($("#box_industry li.current").each(function() {
            a.push($(this).text())
        }),
        "" == a.join() ? $("#select_industry").val("请选择行业领域") : $("#select_industry").val(a.join()),
        $("#com_type").val(a.join()),
        $("#box_industry").hide()),
        $("#box_industry").hide(),
        $("#box_scale").hide(),
        $("#stagesList .box_invest").hide()
    }),
    $("#select_industry").bind("click", function(a) {
        a.stopPropagation(),
        $("#box_industry").show(),
        $("#box_scale").hide(),
        $("#stagesList .box_invest").hide()
    }),
    $("#box_industry").on("click", "ul li", function(a) {
        a.stopPropagation();
        var b = [];
        $(this).hasClass("current") ? ($(this).removeClass("current"),
        $("#box_industry li.current").each(function() {
            b.push($(this).text())
        }),
        $("#select_industry").val(b.join()),
        $("#com_type").val(b.join())) : 0 == $(this).siblings("li.current").length ? ($(this).addClass("current"),
        b.push($(this).text()),
        $("#select_industry").val(b.join()),
        $("#com_type").val(b.join())) : 1 == $(this).siblings("li.current").length ? ($(this).addClass("current"),
        $("#box_industry li.current").each(function() {
            b.push($(this).text())
        }),
        $("#select_industry").val(b.join()),
        $("#com_type").val(b.join()),
        $("#box_industry").hide()) : $(this).siblings("li.current").length >= 2 && alert("行业领域最多可选2个"),
        $("#stepForm").validate().element("#com_type")
    }),
    $("#select_scale").bind("click", function(a) {
        a.stopPropagation(),
        $("#box_scale").show(),
        $("#box_industry").hide(),
        $("#stagesList .box_invest").hide()
    }),
    $("#box_scale").on("click", "ul li", function(a) {
        a.stopPropagation();
        var b = $(this).text();
        $("#select_scale,#com_scale").val(b),
        $("#box_scale").hide(),
        $("#stepForm").validate().element("#com_scale")
    }),
    $("#box_industry,#box_scale").bind("click", function(a) {
        a.stopPropagation()
    }),
    $(".s_radio li").click(function() {
        var b = $(this).text();
        $("#com_capital").val(b),
        $(this).addClass("current").append("<em></em>").siblings().removeClass("current").find("em").remove(),
        $("#stepForm").validate().element("#com_capital")
    }),
    $("#stagesList").on("click", ".select_invest", function(a) {
        a.stopPropagation(),
        $("#box_scale").hide(),
        $("#box_industry").hide(),
        $(this).parents("li").siblings().children(".box_invest").hide(),
        $(this).siblings(".box_invest").show()
    }),
    $("#stagesList").on("click", ".box_invest li", function(a) {
        var b, c;
        a.stopPropagation(),
        b = $(this).html(),
        c = $(this).parents("li"),
        $(".select_invest,.select_invest_hidden", c).val(b),
        $(this).parents(".box_invest").hide(),
        c.index() == $("#stagesList > li").length - 1 && $("#stagesList > li").length < 10 && c.children(".select_invest").trigger("change")
    }),
    $("#stagesList").on("change", ".select_invest", function() {
        var a = $("#cloneInvest").html();
        $("#stagesList").append("<li>" + a + "</li>")
    }),
    $("#stepForm").validate({
        onkeyup: !1,
        focusCleanup: !0,
        rules: {
            com_name: {
                required: !0,
                specialchar: !0,
                maxlenStr: 100
            },
            myfiles: {
                required: !1
            },
            com_website: {
                required: !0,
                checkUrl: !0,
                maxlength: 120
            },
            com_user_phone: {
                required: !0,
                maxlength: 11
            },
            com_email: {
                required: !0,
                maxlength: 50
            },
            com_hr: {
                required: !0,
                maxlength: 20
            },
            com_add: {
                required: !0,
                com_addAvailable: !0,
                maxlenStr: 20
            },
            com_type: {
                required: !0
            },
            com_scale: {
                required: !0
            },
            com_capital: {
                required: !0
            },
            select_invest_hidden: {
                required: !1
            },
            stageorg: {
                required: !1,
                maxlenStr: 100
            },
            com_desc: {
                required: !0,
                checkNum: !0,
                minlength: 5,
                maxlenStr: 50
            }
        },
        messages: {
            com_name: {
                required: "请输入公司的名称",
                specialchar: "请输入公司的名称",
                maxlenStr: "请输入10字以内的公司名称"
            },
            com_website: {
                required: "请输入公司网址",
                checkUrl: "请输入有效的公司网址",
                maxlength: "请输入120字符以内的网址"
            },
            com_add: {
                required: "请输入公司所在城市，如：北京",
                maxlenStr: "请输入有效的公司所在城市"
            },
            com_type: {
                required: "请选择公司行业领域"
            },
            com_scale: {
                required: "请选择公司规模"
            },
            com_capital: {
                required: "请选择公司发展阶段"
            },
            com_email: {
                required: "请输入公司的邮箱"
            },
            com_user_phone: {
                required: "请输入公司的号码"
            },
            com_hr: {
                required: "请输入公司的负责人姓名"
            },
            stageorg: {
                maxlenStr: "请输入100字以内的投资机构"
            },
            com_desc: {
                required: "请一句话概括公司亮点，如：公司愿景、领导团队等，限50字",
                minlength: "请输入5-50字的一句话介绍",
                maxlenStr: "请输入5-50字的一句话介绍"
            }
        },
        errorPlacement: function(a, b) {
            "hidden" == b.attr("type") ? a.insertAfter($(b).parent()) : a.insertAfter(b)
        },
        submitHandler: function(b) {
            var c, d, e, f, g, h, i, j, k, l, m, n, o, x, y, z;
            a = !0,
            c = $("#companyId").val(),
            d = $("#companyName").val(),
            z = $("#com_user_phone").val(),
            x = $("#com_email").val(),
            d = $("#companyName").val(),
            y = $("#com_hr").val(),
            d = $("#companyName").val(),
            e = $("#name").val(),
            f = $("#logoShow img").attr("src"),
            g = $("#com_website").val(),
            "http://" != g.substring(0, 7) && (g = "http://" + g),
            h = $("#com_add").val(),
            i = $("#com_type").val(),
            j = $("#com_scale").val(),
            k = $("#com_capital").val(),
            l = "",
            l += "[",
            $("#stagesList > li").each(function(a) {
                m = $(this).children('input[name="select_invest_hidden"]').val(),
                n = $(this).children('input[name="stageorg"]').val() != $(this).children('input[name="stageorg"]').attr("placeholder") ? $(this).children('input[name="stageorg"]').val() : "",
                l += a == $("#stagesList > li").length - 1 ? '{"stage":"' + m + '","org":"' + n + '"}' : '{"stage":"' + m + '","org":"' + n + '"},'
            }),
            l += "]",
            o = $("#com_desc").val(),
            $(b).find(":submit").attr("disabled", !0),
            $.ajax({
                type: "POST",
                data: {
                    companyId: c,
                    companyName: d,
                    companyShortName: e,
                    logo: f,
                    companyUrl: g,
                    com_add: h,
                    industryField: i,
                    companySize: j,
                    financeStage: k,
                    stages: l,
                    companyFeatures: o
                },
                url: ctx + "/c/saveBaseInfo.json"
            }).done(function(a) {
                a.success ? window.location.href = ctx + "/c/tag.html" : $("#beError").text(a.msg).show(),
                $(b).find(":submit").attr("disabled", !1)
            })
        }
    })
});
